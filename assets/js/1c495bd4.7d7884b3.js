"use strict";(self.webpackChunkdev_notes=self.webpackChunkdev_notes||[]).push([[92],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(n),h=i,m=p["".concat(s,".").concat(h)]||p[h]||u[h]||a;return n?o.createElement(m,r(r({ref:t},d),{},{components:n})):o.createElement(m,r({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:i,r[1]=l;for(var c=2;c<a;c++)r[c]=n[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},1755:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var o=n(7462),i=(n(7294),n(3905));const a={id:"dependency-injection",sidebar_position:1},r="Dependency Injection",l={unversionedId:"techniques/dependency-injection",id:"techniques/dependency-injection",title:"Dependency Injection",description:"Pages describes the main purpose of DI",source:"@site/docs/techniques/dependency-injection.mdx",sourceDirName:"techniques",slug:"/techniques/dependency-injection",permalink:"/dev-notes/techniques/dependency-injection",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"dependency-injection",sidebar_position:1},sidebar:"docs",previous:{title:"Techniques",permalink:"/dev-notes/techniques"},next:{title:"Health Checks",permalink:"/dev-notes/techniques/health-checks"}},s={},c=[{value:"Problem",id:"problem",level:2},{value:"Solution",id:"solution",level:2},{value:"Architectual design",id:"architectual-design",level:3},{value:"Applications and Libraries",id:"applications-and-libraries",level:3},{value:"Misconception",id:"misconception",level:4},{value:"Good module rule",id:"good-module-rule",level:3},{value:"What are common mistakes while creating a new module?",id:"what-are-common-mistakes-while-creating-a-new-module",level:4},{value:"When are modules needed?",id:"when-are-modules-needed",level:4},{value:"What should be the module?",id:"what-should-be-the-module",level:4}],d={toc:c},p="wrapper";function u(e){let{components:t,...a}=e;return(0,i.kt)(p,(0,o.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"dependency-injection"},"Dependency Injection"),(0,i.kt)("p",null,"Pages describes the main purpose of DI"),(0,i.kt)("h2",{id:"problem"},"Problem"),(0,i.kt)("p",null,"Many new developers do not know what CI is and how to use it. How to design systems built on DI, what is IoC, and the result is a confusing relationship between modules in the application"),(0,i.kt)("h2",{id:"solution"},"Solution"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"In software engineering, dependency injection is a design pattern in which an object or function receives other objects or functions that it depends on. A form of inversion of control, dependency injection aims to separate the concerns of constructing objects and using them, leading to loosely coupled programs. The pattern ensures that an object or function which wants to use a given service should not have to know how to construct those services. Instead, the receiving 'client' (object or function) is provided with its dependencies by external code (an 'injector'), which it is not aware of."),(0,i.kt)("p",{parentName:"blockquote"},"Dependency injection helps by making implicit dependencies explicit and helps solve the following problems\nHow can a class be independent from the creation of the objects it depends on?\nHow can an application, and the objects it uses support different configurations?\nHow can the behavior of a piece of code be changed without editing it directly?"),(0,i.kt)("p",{parentName:"blockquote"},"Read more in ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Dependency_injection"},"Wikipedia"))),(0,i.kt)("p",null,"Initially, NestJS doesn't tell us how to properly design code, what folder structure to use, and how to deal with typical module dependency problems. Because of this, developers write code differently. Even if they are doing the same project, the code in microservices can be very different."),(0,i.kt)("p",null,"Here, I will try to describe the known problems that I encountered and how I solved them."),(0,i.kt)("h3",{id:"architectual-design"},"Architectual design"),(0,i.kt)("p",null,"By architecture, I mean the relationship between modules. It should be hierarchical, not chaotic. Design communication between modules in advance, use diagram to outline all cases. Divide your logic into scopes and never use circular dependencies."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"AD",src:n(4267).Z,width:"1772",height:"533"})),(0,i.kt)("h3",{id:"applications-and-libraries"},"Applications and Libraries"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This part was taken from ",(0,i.kt)("a",{parentName:"p",href:"https://nx.dev/more-concepts/applications-and-libraries"},"NX documentation"))),(0,i.kt)("p",null,'A workspace is structured into "apps" and "libs". This distinction allows us to have a more modular architecture by following a separation of concerns methodology, incentivising the organization of our source code and logic into smaller, more focused and highly cohesive units.'),(0,i.kt)("p",null,"Therefore, consuming libraries is very straightforward, and similar to what you might already be accustomed to in previous projects."),(0,i.kt)("p",null,'Having a dedicated library project is a much stronger boundary compared to just separating code into folders, though. Each library has a so-called "public API", represented by an index.ts barrel file. This forces developers into an "API thinking" of what should be exposed and thus be made available for others to consume, and what on the others side should remain private within the library itself.'),(0,i.kt)("h4",{id:"misconception"},"Misconception"),(0,i.kt)("p",null,"Developers new to Nx are initially often hesitant to move their logic into libraries, because they assume it implies that those libraries need to be general purpose and shareable across applications."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"This is a common misconception, moving code into libraries can be done from a pure code organization perspective.")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'Ease of re-use might emerge as a positive side effect of refactoring code into libraries by applying an "API thinking" approach. It is not the main driver though.'),(0,i.kt)("p",{parentName:"blockquote"},"In fact when organizing libraries you should think about your business domains."),(0,i.kt)("p",{parentName:"blockquote"},"Most often teams are aligned with those domains and thus a similar organization of the libraries in the libs/ folder might be most appropriate. Nx allows to nest libraries into sub-folders which makes it easy to reflect such structuring.")),(0,i.kt)("p",null,"A common mental model is to ",(0,i.kt)("strong",{parentName:"p"},'see the application as "containers"')," that link, bundle and compile functionality implemented in libraries for being deployed. As such, if we follow a 80/20 approach:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"place 80% of your logic into the libs/ folder"),(0,i.kt)("li",{parentName:"ul"},"and 20% into apps/")),(0,i.kt)("p",null,"Let's take a look to this structure"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"apps/\n  api/\n  api-e2e/\nlibs/\n  core/                    <---- grouping folder\n    prisma-client/         <---- core database library\n    errors/                <---- core library\n  feature1/                <---- feature library\n  feature2/                <---- feature library\n")),(0,i.kt)("p",null,"Graph will look like this"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Graph",src:n(675).Z,width:"791",height:"921"})),(0,i.kt)("h3",{id:"good-module-rule"},"Good module rule"),(0,i.kt)("h4",{id:"what-are-common-mistakes-while-creating-a-new-module"},"What are common mistakes while creating a new module?"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"You have a new entity in your database"),(0,i.kt)("li",{parentName:"ol"},"You have relationships between your business entities"),(0,i.kt)("li",{parentName:"ol"},"You have large amount of code"),(0,i.kt)("li",{parentName:"ol"},"You have circular dependencies")),(0,i.kt)("h4",{id:"when-are-modules-needed"},"When are modules needed?"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"When you want to publish a part of the project into the npm package"),(0,i.kt)("li",{parentName:"ol"},"When you want to share a part of the project between different applications"),(0,i.kt)("li",{parentName:"ol"},"When there are several teams within the project and it is necessary to share responsibility"),(0,i.kt)("li",{parentName:"ol"},"When you write integration tests, and in order not to run the entire application with all dependencies, you run only a part")),(0,i.kt)("h4",{id:"what-should-be-the-module"},"What should be the module?"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Isolated.")," At best, the module should not depend on anything, so that copying it would be easy. But in practice, isolated modules are not always obtained. Then it is important to correctly design the architecture so that there is minimal connectivity between modules."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Easy to test.")," The module should be designed to be as easy to test as possible."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Independent.")," If you want to move some part of the logic into a module, its dependencies should be direct and explicit. A good example of module misuse is the ConfigModule which is globally injected into all modules. This means that every module in the application depends on the ConfigModule, although this could have been avoided by accepting the configs when the module was imported.")),(0,i.kt)("p",null,"Try not to use ConfigModule in your modules. If module need something, you can create a config and forRoot() functions to import variables into your module as a provider"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"BadGood",src:n(1910).Z,width:"4153",height:"1212"})),(0,i.kt)("p",null,"To avoid circular dependencies you can create a new module that will import all others modules. Also, CD says you that you have a bad module design, maybe you can join your module logic?"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"BadGood",src:n(2904).Z,width:"4141",height:"899"})),(0,i.kt)("p",null,"You should also keep your dependencies in direct hierarchical way"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"BadGood",src:n(4440).Z,width:"5047",height:"1671"})))}u.isMDXComponent=!0},4267:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/di-architectual-design-af096f9c60f0c83e16590ce5498de68b.png"},1910:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/di-bad-good-1-9d6d65c41437645307f271cba43957b3.png"},2904:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/di-bad-good-2-3a153f8e2d2617cd950611ecee2ed729.png"},4440:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/di-bad-good-3-fd1e2a3cf1b9faa623fa3d26debb4690.png"},675:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/di-graph-08c653da66722f791e554b2eb19ddf49.png"}}]);