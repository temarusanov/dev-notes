"use strict";(self.webpackChunkdev_notes=self.webpackChunkdev_notes||[]).push([[113],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},l=Object.keys(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=o.createContext({}),g=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=g(e.components);return o.createElement(i.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=g(n),c=a,d=p["".concat(i,".").concat(c)]||p[c]||m[c]||l;return n?o.createElement(d,r(r({ref:t},u),{},{components:n})):o.createElement(d,r({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,r=new Array(l);r[0]=c;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[p]="string"==typeof e?e:a,r[1]=s;for(var g=2;g<l;g++)r[g]=n[g];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5498:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>g});var o=n(7462),a=(n(7294),n(3905));const l={id:"logging",sidebar_position:3},r="Logging",s={unversionedId:"workspace/techniques/logging",id:"workspace/techniques/logging",title:"Logging",description:"Page describes how to manage logs is much more convenient than it is",source:"@site/docs/workspace/techniques/logging.mdx",sourceDirName:"workspace/techniques",slug:"/workspace/techniques/logging",permalink:"/dev-notes/workspace/techniques/logging",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"logging",sidebar_position:3},sidebar:"docs",previous:{title:"Health Checks",permalink:"/dev-notes/workspace/techniques/health-checks"}},i={},g=[{value:"Problem",id:"problem",level:2},{value:"Solution",id:"solution",level:2},{value:"Features",id:"features",level:3},{value:"Usage/Examples",id:"usageexamples",level:3},{value:"Default output",id:"default-output",level:3},{value:"Json output",id:"json-output",level:3},{value:"Labels",id:"labels",level:3},{value:"Colors",id:"colors",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"FAQ",id:"faq",level:3},{value:"How does it implement NestJS Logger without any framework libs?",id:"how-does-it-implement-nestjs-logger-without-any-framework-libs",level:4},{value:"How can I use logardian in my NestJS service?",id:"how-can-i-use-logardian-in-my-nestjs-service",level:4},{value:"I do not see NestJS logger context",id:"i-do-not-see-nestjs-logger-context",level:4},{value:"I do not see my logs with label",id:"i-do-not-see-my-logs-with-label",level:4}],u={toc:g},p="wrapper";function m(e){let{components:t,...l}=e;return(0,a.kt)(p,(0,o.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"logging"},"Logging"),(0,a.kt)("p",null,"Page describes how to manage logs is much more convenient than it is"),(0,a.kt)("h2",{id:"problem"},"Problem"),(0,a.kt)("p",null,"Imagine a large application in which there is active development and something constantly needs to be debugged.\nThe developers cover everything with debug logs and all this deploys to the server.\nDue to the huge number of logs, it is impossible to find the log you need.\nDevelopers remove all debug logs. After a lot of logs have been removed, a bug appears in production, but now there are no logs."),(0,a.kt)("p",null,"How to find a balance between logs, and turn on only necessary logs?"),(0,a.kt)("h2",{id:"solution"},"Solution"),(0,a.kt)("p",null,"Divide logs into subgroups. Break logs into subgroups.\nFor example, authorization logs, post debug logs, notification debug logs and etc.\nNow, instead of removing logs from the code, you can turn logs on or off at the moment you need"),(0,a.kt)("p",null,"Also you can use built in workspace custom NestJS compatible logger ",(0,a.kt)("inlineCode",{parentName:"p"},"@tematools/logger")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm i --save @tematools/logger\n")),(0,a.kt)("h3",{id:"features"},"Features"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Various labers of logs that can be turned on/off via config"),(0,a.kt)("li",{parentName:"ul"},"In production mode debug() does not work"),(0,a.kt)("li",{parentName:"ul"},"Datetime in UTC format"),(0,a.kt)("li",{parentName:"ul"},"Format of logs: ",(0,a.kt)("inlineCode",{parentName:"li"},"[time] [level] [label] [message]")),(0,a.kt)("li",{parentName:"ul"},"Can be used instead of NestJS Logger"),(0,a.kt)("li",{parentName:"ul"},"Can log any objects, arrays, variables"),(0,a.kt)("li",{parentName:"ul"},"Modes: normal or json format output"),(0,a.kt)("li",{parentName:"ul"},"Colors!")),(0,a.kt)("h3",{id:"usageexamples"},"Usage/Examples"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { Logardian } from 'logardian'\n\nconst logger = new Logardian()\n\nlogger.configure({\n    labels: ['users', '*.debug']\n})\n\nlogger.log(`Hi! I'm info log example`)\nlogger.warn(`Hi! I'm warn log example`)\nlogger.error(`Hi! I'm error log example`)\nlogger.verbose(`Hi! I'm verbose log example`)\nlogger.debug({ some: 'object' })\n\nlogger.markTime('marker')\n\nsetTimeout(() => {\n    logger.measureTime('marker', 'Function take {n} ms to execute')\n}, 2000)\n\nlogger.log(`I will log`, { label: 'users' })\nlogger.log(`I will log too`, { label: 'auth.debug' })\nlogger.log(`I will not log :(`, { label: 'database' })\n")),(0,a.kt)("h3",{id:"default-output"},"Default output"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(9738).Z,width:"593",height:"198"})),(0,a.kt)("h3",{id:"json-output"},"Json output"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Json logs are useful to push logs in Loki or Elastic and make flexible queries")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"logger.configure({\n    json: true\n})\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'{"timestamp":"2022-10-10T12:39:40.012Z","message":"Starting Nest application...","level":"log"}\n{"timestamp":"2022-10-10T12:39:40.017Z","message":"AppModule dependencies initialized","level":"log"}\n{"timestamp":"2022-10-10T12:39:40.020Z","message":"Nest application successfully started","level":"log"}\n{"timestamp":"2022-10-10T12:39:40.022Z","message":"Hi! I\'m info log example","level":"log"}\n{"timestamp":"2022-10-10T12:39:40.022Z","message":"Hi! I\'m warn log example","level":"warn"}\n{"timestamp":"2022-10-10T12:39:40.022Z","message":"Hi! I\'m error log example","level":"error"}\n{"timestamp":"2022-10-10T12:39:40.022Z","message":"Hi! I\'m verbose log example","level":"verbose"}\n{"timestamp":"2022-10-10T12:39:40.022Z","message":"{\\"some\\":\\"object\\"}","level":"debug"}\n{"timestamp":"2022-10-10T12:39:40.023Z","message":"I will log","level":"log","label":"users"}\n{"timestamp":"2022-10-10T12:39:40.024Z","message":"I will log too","level":"log","label":"auth.debug"}\n{"timestamp":"2022-10-10T12:39:42.024Z","message":"Function take 2002.041 ms to execute","level":"timer"}\n')),(0,a.kt)("h3",{id:"labels"},"Labels"),(0,a.kt)("p",null,"Labels now support glob patterns! You can dynamically enable and disable the logs you need via ",(0,a.kt)("inlineCode",{parentName:"p"},"logger.configure()"),". For example:"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Using ",(0,a.kt)("a",{parentName:"p",href:"https://developer.hashicorp.com/consul/docs/dynamic-app-config/kv"},"HCP Consul KV")," you can dynamically change labels in your application, without restarting it")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { Logardian } from 'logardian'\n\nconst logger = new Logardian()\n\nlogger.configure({\n    labels: ['users.*']\n})\n\nlogger.log('User sent mail', { label: 'users.email' }) // will log\nlogger.log('User registered', { label: 'users.auth.registration' }) // will log\nlogger.log('User authorized', { label: 'users.auth.authorization' }) // will log\nlogger.log('Database connected', { label: 'database' }) // will NOT log\nlogger.log('User entity created', { label: 'database.users' }) // will NOT log\n")),(0,a.kt)("h3",{id:"colors"},"Colors"),(0,a.kt)("p",null,"If you don't like the set of colors logardian provides you can change them in ",(0,a.kt)("inlineCode",{parentName:"p"},"configure()")," function."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const logger = new Logardian()\n\nlogger.configure({\n    colors: {\n        timestamp: '#ABC',\n        traceId: '#CCC',\n        label: '#FFFFFF',\n        message: '#FFFFFF',\n        trace: '#FFFFFF',\n        stack: '#000000'\n    }\n})\n")),(0,a.kt)("h3",{id:"environment-variables"},"Environment Variables"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"NODE_ENV")," production start does not show debug() logs"),(0,a.kt)("h3",{id:"faq"},"FAQ"),(0,a.kt)("h4",{id:"how-does-it-implement-nestjs-logger-without-any-framework-libs"},"How does it implement NestJS Logger without any framework libs?"),(0,a.kt)("p",null,"We made logger based on ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nestjs/nest/blob/master/packages/common/services/logger.service.ts"},"LoggerService")," but we don't explicitly import it so that we stay dependless of NestJS libraries. But you can also use the Logardian instead of common NestJS logger."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// main.ts\nimport { Logardian } from 'logardian'\n\nconst logger = new Logardian()\n\nasync function bootstrap(): Promise<void> {\n    const app = await NestFactory.create(AppModule, { logger })\n\n    await app.listen(port, hostname, () =>\n        logger.log(`Server running at ${hostname}:${port}`),\n    )\n}\n")),(0,a.kt)("h4",{id:"how-can-i-use-logardian-in-my-nestjs-service"},"How can I use logardian in my NestJS service?"),(0,a.kt)("p",null,"Simply create a new logger class"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { Logardian } from 'logardian'\n\n@Injectable()\nexport class CatService {\n    private readonly _logger = new Logardian()\n}\n")),(0,a.kt)("h4",{id:"i-do-not-see-nestjs-logger-context"},"I do not see NestJS logger context"),(0,a.kt)("p",null,"Yeah, that's a problem. And for know I don't know quickfix for that"),(0,a.kt)("h4",{id:"i-do-not-see-my-logs-with-label"},"I do not see my logs with label"),(0,a.kt)("p",null,"Specify labels you want to log or write ",(0,a.kt)("inlineCode",{parentName:"p"},"*")," to log every log with label.\nWorking in production and development mode"),(0,a.kt)("p",null,"Logardian is a singleton, so it means that ",(0,a.kt)("inlineCode",{parentName:"p"},"configure()")," works on all Logardian instances"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"import { Logardian } from 'logardian'\n\nconst logger = new Logardian()\n\nlogger.configure({\n    labels: '*', // or ['database', 'events'] or false\n    trace: false,\n    json: true,\n    traceId: true\n})\n")))}m.isMDXComponent=!0},9738:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/logs-cb7dde80d0bcf063b5d6fd72cccbe9d5.png"}}]);